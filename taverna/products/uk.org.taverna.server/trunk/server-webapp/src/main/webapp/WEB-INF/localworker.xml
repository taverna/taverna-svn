<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<bean id="localworker.factory" class="org.taverna.server.master.localworker.ForkRunFactory"
		scope="singleton" lazy-init="false" init-method="initFactory"
		destroy-method="killFactory">
		<description>
			The simple policy manager and factory for the baseline
			localworker case.
		</description>
		<property name="state" ref="localworker.state" />
		<property name="runDB" ref="localworker.runDB" />
	</bean>

	<bean id="localworker.state" class="org.taverna.server.master.localworker.LocalWorkerState"
		scope="singleton" lazy-init="false">
		<description>
			The state of the simple factory for the baseline
			localworker.
		</description>
		<property name="defaultLifetime" value="1440">
			<description>How long the run lasts for by default, in seconds.
			</description>
		</property>
		<property name="maxRuns" value="100">
			<description>The maximum simultaneous number of runs.</description>
		</property>
		<property name="extraArgs">
			<description>Any extra arguments (memory control, etc.) to pass to
				the spawned subprocesses.</description>
			<list>
			</list>
		</property>
		<property name="waitSeconds" value="40">
			<description>An upper bound (in seconds) on the time to wait for a
				subprocess to start before failing it.</description>
		</property>
		<property name="sleepMS" value="1000">
			<description>The time to wait (in milliseconds) between polling for
				the subprocess to complete its registration.</description>
		</property>
		<property name="persistenceManagerFactory" ref="pmf" />
		<!--
		<property name="javaBinary">
			<description>The name of the java executable used to run the server
				worker. Defaults to the executable used to run the hosting
				environment.</description>
		</property>
		-->
		<!--
		<property name="serverWorkerJar">
			<description>The full path to the executable JAR file containing the
				implementation of the server worker.</description>
		</property>
		-->
		<!--
		<property name="executeWorkflowScript">
			<description>The full path to the executeworkflow.sh in either the
				Taverna 2 Workbench distribution or the Taverna 2 Command Line
				distribution.</description>
		</property>
		-->
	</bean>

	<bean id="localworker.policy" class="org.taverna.server.master.localworker.PolicyImpl">
		<description>
			The implementation of the access control policy
			supported by the localworker run engine.
		</description>
		<property name="state" ref="localworker.state" />
		<property name="runDB" ref="localworker.runDB" />
	</bean>
	<bean id="localworker.runDB" class="org.taverna.server.master.localworker.RunDatabase">
		<description>
			The implementation of the catalog of workflow runs
			supported by the localworker run engine.
		</description>
		<property name="state" ref="localworker.state" />
		<property name="persistenceManagerFactory" ref="pmf" />
	</bean>

	<bean id="localworker.runDB.cleaner" class="org.springframework.scheduling.timer.ScheduledTimerTask">
		<property name="delay" value="10000" />
		<property name="period" value="30000" />
		<property name="timerTask">
			<bean id="localworker.cleanDBNow"
				class="org.springframework.scheduling.timer.MethodInvokingTimerTaskFactoryBean">
				<property name="targetObject" ref="localworker.runDB" />
				<property name="targetMethod" value="cleanNow" />
			</bean>
		</property>
	</bean>
	
	<alias name="localworker.policy" alias="policy" />
	<alias name="localworker.runDB" alias="runCatalog" />
	<alias name="localworker.factory" alias="runFactory" />
	<alias name="localworker.factory" alias="listenerFactory" />
	<alias name="localworker.runDB.cleaner" alias="deleteExpiredWorkflowRuns" />
</beans>
