<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Taverna 2 Server release 2</title>
</head>
<body>
<h1>Taverna 2 Server release 2</h1>
<p>For a full list of operations, see the <a
	href="SERVICE_URI/services">service listing</a> generated by Apache
CXF, which indicates where to access the WSDL and WADL descriptions of
the T2Server interface.</p>
<h2>Simple Guide to Using the REST API</h2>
<p>The Taverna 2 Server supports both REST and SOAP APIs; you may
use either API to access the service and any of the workflow runs hosted
by the service. This simple guide just discusses the REST API.</p>
<ol>
	<li>
	<p>The client starts by creating a workflow run. This is done by
	POSTing a wrapped T2flow or SCUFL2 document to the service at the
	address <tt>SERVICE_URI/rest/runs</tt></p>
	<p>The wrapping of the submitted document is a single XML element,
	<code>scufl</code> in the namespace <code>http://ns.taverna.org.uk/2010/xml/server/</code>,
	and the workflow (as saved by the Taverna Workbench) is the child
	element of that.</p>
	<p>The result of the POST is an HTTP redirect to the location of
	the created run, <tt>SERVICE_URI/rest/runs/<b>UUID</b></tt> (where <tt><b>UUID</b></tt>
	is a unique string that identifies the particular run; this is also the
	name of the run that you would use in the SOAP interface). Note that
	the run is not yet actually doing anything.</p>
	</li>
	<li>
	<p>Next, you need to set up the inputs to the workflow ports. This
	is done by either uploading a file that is to be read from, or by
	directly setting the value.</p>
	<dl>
		<dt><i>Directly Setting the Value of an Input</i></dt>
		<dd>
		<p>To set the input port, <tt><b>FOO</b></tt>, to have the value <tt><b>BAR</b></tt>,
		you would PUT a message like this to the URI <tt>SERVICE_URI/rest/runs/<b>UUID</b>/input/input/<b>FOO</b></tt></p>
		<blockquote><pre>&lt;t2sr:runInput xmlns:t2sr=&quot;http://ns.taverna.org.uk/2010/xml/server/rest/&quot;&gt;
    &lt;t2sr:value&gt;<b>BAR</b>&lt;/t2sr:value&gt;
&lt;/t2sr:runInput&gt;</pre></blockquote>
		</dd>

		<dt><i>Uploading a File for One Input</i></dt>
		<dd>
		<p>The values for an input port can also be set by means of
		creating a file on the server. Thus, if you were staging the value BAR
		to input port FOO by means of a file BOO.TXT then you would first POST
		this message to <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd</tt></p>
		<blockquote><pre>&lt;t2sr:upload xmlns:t2sr="http://ns.taverna.org.uk/2010/xml/server/rest/" name="<b>BOO.TXT</b>"&gt;
    QkFS
&lt;/t2sr:upload&gt;</pre></blockquote>
		<p>Note that &#x201c;<tt>QkFS</tt>&#x201d; is the base64-encoded
		form of &#x201c;<tt>BAR</tt>&#x201d;, and that each workflow run has
		its own working directory into which the uploads are placed; you are
		never told the name of this working directory.</p>
		<p>Once you've created the file, you can then set it to be the
		input for the port by PUTting this message to <tt>SERVICE_URI/rest/runs/<b>UUID</b>/input/input/<b>FOO</b></tt></p>
		<blockquote><pre>&lt;t2sr:runInput xmlns:t2sr="http://ns.taverna.org.uk/2010/xml/server/rest/"&gt;
    &lt;t2sr:file&gt;<b>BOO.TXT</b>&lt;/t2sr:file&gt;
&lt;/t2sr:runInput&gt;</pre></blockquote>
		<p>Note the similarity of the final part of this process to the
		previous method for setting an input.</p>
		<p>You can also create a directory, e.g., IN, to hold the input
		files. This is done by POSTing a different message to <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd</tt></p>
		<blockquote><pre>&lt;t2sr:mkdir xmlns:t2sr="http://ns.taverna.org.uk/2010/xml/server/rest/" name="<b>IN</b>" /&gt;</pre></blockquote>
		<p>With that, you can then create files in the IN subdirectory by
		sending the <tt>upload</tt> message to <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd/IN</tt>
		and you can use the file as an input by using a name such as <tt>IN/BOO.TXT</tt>.
		You can also create sub-subdirectories if required by sending the <tt>mkdir</tt>
		message to the natural URI of the parent directory, just as sending an
		<tt>upload</tt> message to that URI creates a file in that directory.</p>
		</dd>

		<dt><i>Uploading a Baclava File</i></dt>
		<dd>
		<p>The final way of setting up the inputs to a workflow is to
		upload (using the same method as above) a Baclava file (e.g., <tt><b>FOOBAR.BACLAVA</b></tt>)
		that describes the inputs. This is then set as the provider for <i>all</i>
		inputs by PUTting the name of the Baclava file (as plain text) to <tt>SERVICE_URI/rest/runs/<b>UUID</b>/input/baclava</tt></p>
		</dd>
	</dl>
	</li>
	<li>
	<p>Now you can start the file running. This is done by using a PUT
	to set <tt>SERVICE_URI/rest/runs/<b>UUID</b>/status</tt> to the plain text
	value <tt>Operating</tt>.</p>
	</li>
	<li>
	<p>Now you need to poll, waiting for the workflow to finish. To
	discover the state of a run, you can (at any time) do a GET on <tt>SERVICE_URI/rest/runs/<b>UUID</b>/status</tt>;
	when the workflow has finished executing, this will return <tt>Finished</tt>
	instead of <tt>Operating</tt> (or <tt>Initialized</tt>, the starting
	state).</p>
	<p>There is a fourth state, <tt>Stopped</tt>, but it is not
	supported in this release.</p>
	</li>
	<li>
	<p>Every workflow run has an expiry time, after which it will be
	destroyed and all resources (i.e., local files) associated with it
	cleaned up. By default in this release, this is 20 minutes after
	initial creation. To see when a particular run is scheduled to be
	disposed of, do a GET on <tt>SERVICE_URI/rest/runs/<b>UUID</b>/expiry</tt>;
	you may set the time when the run is disposed of by PUTting a new time
	to that same URI. Note that this includes not just the time when the
	workflow is executing, but also when the input files are being created
	beforehand and when the results are being downloaded afterwards; you
	are advised to make your clients regularly advance the expiry time
	while the run is in use.</p>
	</li>
	<li>
	<p>The outputs from the workflow are files created in the <tt>out</tt>
	subdirectory of the run's working directory. The contents of the
	subdirectory can be read by doing a GET on <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd/out</tt>
	which will return an XML document describing the contents of the
	directory, with links to each of the files within it. Doing a GET on
	those links will retrieve the actual created files (as uninterpreted
	binary data).</p>
	<p>Thus, if a single output <tt><b>FOO.OUT</b></tt> was produced
	from the workflow, it would be written to the file that can be
	retrieved from <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd/out/<b>FOO.OUT</b></tt>
	and the result of the GET on <tt>SERVICE_URI/rest/runs/<b>UUID</b>/wd/out</tt>
	would look something like this:</p>
	<blockquote><pre>&lt;t2sr:directoryContents xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns:t2sr="http://ns.taverna.org.uk/2010/xml/server/rest"
        xmlns:t2s="http://ns.taverna.org.uk/2010/xml/server/"&gt;
    &lt;t2s:file xlink:href="SERVICE_URI/rest/runs/<b>UUID</b>/wd/out/<b>FOO.OUT</b>"
            &gt;out/<b>FOO.OUT</b>&lt;/t2s:file&gt;
&lt;/t2sr:directoryContents&gt;</pre></blockquote>
	</li>
	<li>
	<p>The standard output and standard error from the T2 Command Line
	Executor subprocess can be read via properties of the special I/O
	listener. To do that, do a GET on <tt>SERVICE_URI/rest/runs/<b>UUID</b>/listeners/io/properties/<b>stdout</b></tt>
	(or <tt>.../<b>stderr</b></tt>). Once the subprocess has finished
	executing, the I/O listener will provide a third property containing
	the exit code of the subprocess, called <tt>exitcode</tt>.</p>
	<p>Note that the supported set of listeners and properties will be
	subject to change in future versions of the server, and should not be
	relied upon.</p>
	</li>
	<li>
	<p>Once you have finished, destroy the run by doing a DELETE on <tt>SERVICE_URI/rest/runs/<b>UUID</b></tt>.
	Once you have done that, none of the resources associated with the run
	(including both input and output files) will exist any more. If the run
	is still executing, this will also cause it to be stopped.</p>
	</li>
</ol>
<p>All operations described above have equivalents in the SOAP
service interface.</p>

<div>
<hr>
<p><small>Copyright &copy; 2010. The University of
Manchester.</small></p>
<p><small>Software Release ID: ${project.version}</small></p>
</div>
</body>
</html>