<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>

<title>Untitled Document</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

</head>



<body>

<h1 align="justify"><font size="4" face="Arial, Helvetica, sans-serif">Taverna 

  User Level Documentation</font></h1>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Last updated 

  $Date: 2003-05-20 18:00:16 $</font></p>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This document 

  should provide enough information for other <sup>my</sup>Grid developers to 

  make use of the joint <a href="http://www.it-innovation.soton.ac.uk">IT Innovation</a> 

  / <a href="http://www.ebi.ac.uk">EBI</a> / <a href="http://www.hgmp.mrc.ac.uk">HGMP</a> 

  work on a new workflow language, its associated object model, parsers and views. 

  If there isn't sufficient information here, please email me (<a href="mailto:tmo@ebi.ac.uk">tmo@ebi.ac.uk</a>) 

  and pester me into providing it, there's not much point in us doing all this 

  work if you can't use it, right? In order to make all your workflow editing 

  and document reading faster and more fun, I have added randomly garish colours 

  to certain sections. These colours have no actual significance whatsoever, other 

  than maybe to highlight the bits you need to look at if you're in a hurry.</font></p>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The motivation 

  for providing a new workflow language is not covered by this document, but please 

  refer to <a href="http://taverna.sourceforge.net">http://taverna.sourceforge.net</a> 

  for more information if you so desire.</font></p>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">A note on 

  stability - Taverna is an ongoing project, we reserve the right to change things 

  mentioned here if we feel justified in doing so. It would be helpful to both 

  us and yourself therefore if you were to let us know if you're using any of 

  this, just a quick mention on one of the <sup>my</sup>Grid lists would be cool.</font></p>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Tom & Darren</font></p>

<hr>

<h2 align="justify"><font size="3" face="Arial, Helvetica, sans-serif">XScufl Workflow 

  Language</font></h2>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">XScufl is 

  the XML dialect of the Simple Conceptual Unified Flow Language. Operating at 

  a higher level of abstraction than alternatives such as WSFL, Scufl aims to 

  provide the following features:</font></p>

<ul>

  <li> 

    <div align="justify"><font size="2" face="Arial, Helvetica, sans-serif"> Work 

      with the same level of granularity that users will be thinking in.</font></div>

  </li>

  <li> 

    <div align="justify"><font size="2" face="Arial, Helvetica, sans-serif"> Invoke 

      remote and local services and pass results between them, services include 

      at the present time.</font></div>

    <ul>

      <li><font size="2" face="Arial, Helvetica, sans-serif"> Arbitrary WSDL-based 

        single operation web services</font></li>

      <li><font size="2" face="Arial, Helvetica, sans-serif"> Soaplab bio-services</font></li>

      <li><font size="2" face="Arial, Helvetica, sans-serif"> Talisman tscript 

        definitions</font></li>

      <li><font color="#666666" size="2" face="Arial, Helvetica, sans-serif"> Nested scufl workflows 

        (to be implemented soon - tmo, 26th April 2003)</font></li>

    </ul>

  </li>

</ul>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Ideally 

  one conceptual operation in the design of a workflow translates to one processor 

  in a scufl definition. Although this may not always be possible, in general 

  you can be fairly close most of the time.</font></p>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">In this 

  document, the terms scufl and xscufl are used pretty much interchangably. Although 

  there is actually a textual version called scufl (to distinguish it from the 

  xml form) we haven't had time to bring that in synch with the rest of the project, 

  so for now I'm afraid you'll have to use the XML form.</font></p>

<hr>

<h2 align="justify"><font size="3" face="Arial, Helvetica, sans-serif">XScufl 

  Anatomy</font></h2>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">An XScufl 

  file consists of the following tags, assuming that the namespace '<font face="Courier New, Courier, mono">s</font>' 

  has been defined as <font face="Courier New, Courier, mono">http://org.embl.ebi.escience/xscufl/0.1alpha</font> 

  </font></p>

<table width="75%" border="1" align="center" cellpadding="4" cellspacing="0">

  <tr valign="top"> 

    <td width="28%"><pre>&lt;s:scufl&gt;</pre></td>

    <td width="72%"><div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This 

        is the top level tag enclosing a single scufl workflow definition. </font></div></td>

  </tr>

  <tr valign="top"> 

    <td><pre>&lt;s:processor&gt;</pre></td>

    <td> <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Defines 

        a single atomic processing step, for example the seqret tool from Soaplab, 

        or a single operation on an arbitrary web service.</font></p></td>

  </tr>

  <tr valign="top"> 

    <td><pre>&lt;s:link&gt;</pre></td>

    <td><div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Defines 

        a data link between two processors.</font></div></td>

  </tr>

  <tr valign="top"> 

    <td><pre>&lt;s:source&gt;</pre></td>

    <td><div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Defines 

        a workflow source, that is to say an externally visible input into the 

        workflow. Elements in the input.xml file map directly to these source 

        declarations.</font></div></td>

  </tr>

  <tr valign="top"> 

    <td><pre>&lt;s:sink&gt;</pre></td>

    <td><font size="2" face="Arial, Helvetica, sans-serif">Defines a workflow sink, these map one to one to elements 

      in the output from the workflow enactor.</font></td>

  </tr>

  <tr valign="top"> 

    <td><pre><font color="#000000">&lt;s:coordination&gt;</font></pre></td>

    <td><div align="justify"><font color="#000000" size="2" face="Arial, Helvetica, sans-serif">Defines 

        a concurrency constraint, now fully implemented.</font></div></td>

  </tr>

</table>

<p>&nbsp;</p><hr noshade>

<pre>&lt;s:scufl version=&quot;<font color="#CC0000">0.1</font>&quot;&gt;</pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This tag 

  must have a version attribute, currently the version should be '0.1'</font></p>

<hr noshade>

<pre><font size="2">&lt;s:processor name=&quot;<font color="#CC0000">the_processor_name</font>&quot;&gt;</font></pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Processors 

  have a name, this name may not include the ':' character and must be unique 

  within the workflow definition. The immediate single child element of the processor 

  defines the type of operation. Currently valid types are</font></p>

<blockquote> 

  <pre><font size="2">&lt;s:soaplabwsdl&gt;<font color="#660099">http://url.to.your/soaplab/endpoint</font>&lt;/s:soaplabwsdl&gt;</font></pre>

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The soaplabwsdl 

    processor type allows you to call a complete soaplab invocation in one unit. 

    The endpoint should be the full URL to the service endpoint, so including, 

    for example, edit::seqret at the end. Port names are extracted from the keys 

    of the Soaplab input and output Map objects.</font></p>

  <pre><font size="2">&lt;s:arbitrarywsdl&gt;

  &lt;s:wsdl&gt;<font color="#669933">http://url.to.your/wsdl/definition/file.wsdl</font>&lt;/s:wsdl&gt;

  &lt;s:porttype&gt;<font color="#669900">port_type_name</font>&lt;/s:porttype&gt;

  &lt;s:operation&gt;<font color="669900">operation_name</font>&lt;/s:operation&gt;

&lt;/s:arbitrarywsdl&gt;</font></pre>

  <div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The 

    arbitrarywsdl type allows a single call on a web service. Port names are derived 

    from the part names in the input and output messages for the specified operation. 

    </font> </div>

  <pre><font size="2">&lt;s:talisman&gt;

  &lt;s:tscript&gt;<font color="996600">http://url.to.your/talisman/tscript/file.xml</font>&lt;/s:tscript&gt;

&lt;/s:talisman&gt;</font>

</pre>

  <div align="justify"> 

    <p><font size="2" face="Arial, Helvetica, sans-serif">The talisman type allows 

      you to invoke a Talisman session as a service in your workflow. Currently 

      this doesn't use Talisman as a remote service, and will run the application 

      in the same address space as the enactor itself. Although not ideal in the 

      long run this should work fine for now. The tscript tag contains the full 

      URL to a tscript XML file; this in turn specifies the Talisman application 

      definition, a set of inputs and outputs and the operational behavious of 

      this service in terms of Talisman trigger invocations. The port names are 

      taken directly from the tscript file. The tscript definitions must be accessible 

      at processor creation time, but are not required after this stage. The scripts 

      look like this (in another file) :</font></p>

  </div>

  <blockquote> 

    <div align="justify"> 

      <pre><font size="2">&lt;tscript url=&quot;<font color="#000066">http://localhost:8080/regex.xml</font>&quot;<br>         trigger=&quot;<font color="#000066">Do Substitution</font>&quot;&gt;<br>  &lt;input name=&quot;inputString&quot;&gt;<font color="#000066">field:SourceField</font>&lt;/input&gt;<br>  &lt;output name=&quot;outputString&quot;&gt;<font color="#000066">field:SourceField</font>&lt;/output&gt;<br>&lt;/tscript&gt;</font></pre>

    </div>

    <div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The 

      script above directs the creation of a Talisman application session from 

      the regex.xml file, then that first a string should be read from the port 

      named 'inputString' and placed in the field with 'field:SourceField' as 

      its locator within the page (see Talisman documentation for exactly what 

      this means), then that a trigger called 'Do Substitution' should be run, 

      then that the same Talisman field should be copied to the output port 'outputString'. 

      As it happens, this script creates a processor that reads a string in and 

      replaces all occurences of a certain substring with 'foo' on its output 

      port. There would normally be multiple inputs and outputs, just that this 

      application only has one of each. </font></div>

  </blockquote>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Processors 

  communicate by named ports, these can be either input or output ports, and are 

  automatically built in the object model when one of the above processor types 

  is constructed. For this reason, there is no explicit port declaration in the 

  scufl language. In general, where a port reference is required, it is of the 

  form 'processor_name:port_name', hence the ban on ':' in processor names (the 

  parser code is simple and would be upset by it).</font></p>

<hr noshade>

<pre><font size="2">&lt;s:link&gt;</font></pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Data links, 

  or data constraints in the original language spec and the object model, represent 

  a flow of information from an output port to an input port. The link syntax 

  is very simple :</font></p>

<blockquote>

  <pre>&lt;s:link&gt;

  &lt;s:input&gt;<font color="#CC0099">prophet:infile_direct_data</font>&lt;/s:input&gt;

  &lt;s:output&gt;<font color="cc0099">prophecy:outf</font>&lt;/s:output&gt;

&lt;/s:link&gt;</pre>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The link 

  syntax currently does not allow naming of links, if you particularly need this 

  then we could add it, at the moment a link is uniquely specified by start and 

  end ports, so a name is not really adding any information (duplicate links are 

  not permitted). As described above, the name for the port consists of the processor 

  name (within the scope of this workflow definition), followed by a single colon 

  ':' followed by the name of a port of the appropriate type in that processor. 

  Supplying an invalid name will result in an exception being thrown on data model 

  creation. </font></p>

<hr noshade>

<pre><font size="2">&lt;s:source&gt;</font></pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This defines 

  a workflow source. You use these to get input data into the workflow. The source 

  is named, and this name can be used (without any processor prefix and ':') in 

  data links to connect a port in an internal processor to a workflow source.</font></p>

<blockquote> 

  <pre><font size="2">&lt;s:source&gt;<font color="#FF0033">input_sequence</font>&lt;/s:source&gt;</font></pre>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The input 

  document that the enactor reads contains named inputs; these names should match 

  with the names of your workflow sources. In addition, should this workflow be 

  used as a processor (nested workflow) in the future, the source names will be 

  mapped directly to input port names for the resultant processor.</font></p>

<hr noshade>

<pre><font size="2">&lt;s:sink&gt;</font></pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This is 

  similar to the source directive defined above, but defines an overall workflow 

  sink. As with the source, this may be used in a data link to send a processor's 

  output to the workflow sink, thus making it visible outside the workflow.</font></p>

<blockquote> 

  <pre><font size="2">&lt;s:sink&gt;<font color="#336666">some_output</font>&lt;/s:sink&gt;</font></pre>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The output 

  document produced by the workflow enactor contains named outputs with a one 

  to one mapping between these named outputs and workflow sinks.</font></p>

<hr noshade>

<pre><font size="2">&lt;s:coordination&gt;</font></pre>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The coordination 

  constraints restrict the execution of processors contingent on some gate condition 

  being met. This is required when you have a process where the stages must execute 

  in a certain order and yet there is no direct data dependency between them. 

  An example of this is invocation of Soaplab using the derived interfaces; we 

  first create a job which returns a job ID - no problem, we can block the next 

  stage on that ID being returned, but then we have to set inputs, run the job, 

  get the results and clean up, none of which have data links. So, we have a way 

  to say 'only allow this processor to go from scheduled to running if this other 

  processor has status completed'. In all probability you won't need to do this 

  very often.</font></p>

<blockquote>

  <pre align="justify">

&lt;s:coordination name=&quot;<font color="#0000FF">testcoordination</font>&quot;&gt;

  &lt;s:condition&gt;

    &lt;s:target&gt;<font color="#0000FF">restrict_mutant</font>&lt;/s:target&gt;

    &lt;s:state&gt;<font color="#0000FF">COMPLETED</font>&lt;/s:state&gt;

  &lt;/s:condition&gt;

  &lt;s:action&gt;

    &lt;s:target&gt;<font color="#0000FF">compare</font>&lt;/s:target&gt;

    &lt;s:statechange&gt;

      &lt;s:from&gt;<font color="#0000FF">SCHEDULED</font>&lt;/s:from&gt;

      &lt;s:to&gt;<font color="#0000FF">RUNNING</font>&lt;/s:to&gt;

    &lt;/s:statechange&gt;

  &lt;/s:action&gt;

&lt;/s:coordination&gt;</pre>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The above 

  coordination block states that the processor 'compare' should only be allowed 

  to transition from 'scheduled' to 'running' if the processor 'restrict_mutant' 

  has achieved status 'completed'. Available states are scheduled, running, completed 

  and aborted.</font></p>

<hr>

<h2><font size="3" face="Arial, Helvetica, sans-serif">XScufl Workflow Enactment 

  using the IT Innovation Workflow Enactor</font></h2>

<p><font size="2" face="Arial, Helvetica, sans-serif">XScufl Language Support</font></p>

<p><font size="2" face="Arial, Helvetica, sans-serif">The myGrid workflow enactment engine 

  supports almost all the XScufl language constructs. The only exception is that 

  there is not full support for the coodination constraints. In particular the 

  enactment engine does not support all possible state transitions that an XScufl 

  coordination constraint can define. This is essentially because the enactment 

  engine has its own state models that enforce correct behaviour for the activities 

  it controls. At present the enactment engine will only allow coordination constraints 

  that conform to the following state transition:</font></p>

<p><img src="controlflow.png" width="358" height="60"></p>

<p><font size="2" face="Arial, Helvetica, sans-serif">At present the most common 

  reason for using coordination constraints is to represent a dependency between 

  two processors that is not actually a data dependency, this is essentially the 

  case where you would like processor A to execute and complete before processor 

  B commences execution. In XScufl this would be represented precisely as shown 

  above for the coordination constraint called 'testcoordination', given a suitable 

  substitution of 'A' for 'restrict_mutant' and 'B' for 'compare'. If the enactment 

  engine receives a coordination constraint that does not conform to this restriction 

  then the workflow will be rejected and no execution will take place..</font></p>

<p><font size="2" face="Arial, Helvetica, sans-serif">Configuring myGrid Workflow Enactment 

  Engine </font></p>

<blockquote> 

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">It is 

    very easy to switch on myGrid Enactment Engine support for the XScufl workflow 

    language. The process only involves copying some libraries and making some 

    configuration changes. Note it is necessary to use Java 1.4.1 for the Enactment 

    Engine. The complete process is described here.</font></p>

  <ul>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify">Install 
      the myGrid Enactment Engine as directed by its accompanying user manual. 
      You should install version 0.1.4.2 or later.</font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> From 

      within the Taverna source distribution directory 'taverna1.0' execute 'ant 

      enactor.ext.jar'. This builds the taverna extensions library.</font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Copy 

      '<em>taverna1.0/build/tavernaenactor.jar</em>' to '<em>mygrid-wfenactor/lib</em>'.</font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Copy 

      '<em>taverna1.0/devlib/servlet.jar</em>' to '<em>mygrid-wfenactor/lib</em>'.</font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif">Copy '<em>taverna1.0/lib/talisman1.4.5.11.jar</em>' 

      to '<em>mygrid-wfenactor/lib</em>'</font></li>

  </ul>

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif"> For Standalone 

    Enactor continue by:</font></p>

  <ul>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify">Edit 

      the myGrid Enactment Engine configuration file 'mygrid-wfenactor/conf/standalone/mygrid.properties'. 

      In particular change the value for 'mygrid.workflow.enactor.api.class' to 

      'uk.ac.soton.itinnovation.taverna.enactor.TavernaWorkflowEnactor' </font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Edit 

      the file 'mygrid-wfenactor/bin/runenactor.bat' by adding '..\lib\tavernaenactor.jar', 

      '..\lib\servlet.jar' and '..\lib\talisman1.4.5.11.jar' to the classpath 

      argument.</font></li>

  </ul>

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">For Web 

    Service Enactor continue by:</font></p>

  <ul>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify">Edit 

      the myGrid Enactment Engine configuration file 'mygrid-wfenactor/conf/webservice/mygrid.properties'. 

      In particular change the value for 'mygrid.workflow.enactor.api.class' to 

      'uk.ac.soton.itinnovation.taverna.enactor.TavernaWorkflowEnactor' </font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Edit 

      the file 'mygrid-wfenactor/bin/runwsclient.bat' by adding '..\lib\servlet.jar' 

      to the classpath argument. </font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Redeploy 

      the myGrid Enactment Engine as directed by its manual. </font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Copy 

      'taverna1.0/build/tavernaenactor.jar' to $TOMCAT_HOME/webapps/axis/WEB-INF/lib' 

      </font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify">Restart 

      Tomcat.</font></li>

    <li><font size="2" face="Arial, Helvetica, sans-serif" align="justify"> Off 

      you go. </font></li>

  </ul>

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">You can 

    use the sample standalone and gui clients for the myGrid Enactment Engine. 

    There are sample emboss tutorial workflows, input and user files in the directory 

    'taverna1.0/src/uk/ac/soton/itinnovation/taverna/enactor/broker/test'. You 

    should find that this workflow executes far quicker than its WSFL alternative.</font></p>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">The steps 

  above assume that you have a copy of the Taverna project checked out locally, 

  and that you have also obtained the appropriate Talisman jar file from somewhere 

  (at the moment this is included in the Taverna lib directory, obviously as the 

  jar is versioned in the name you should use the current copy in your distribution).</font></p>

<hr>

<h2><font size="3" face="Arial, Helvetica, sans-serif">Obtaining and building 

  a copy of the Taverna project code</font></h2>

<p><font size="2" face="Arial, Helvetica, sans-serif">Copied from sourceforge's 

  '<em>how to use anonymous cvs</em>' documentation :</font></p>

<blockquote> 

  <p><font size="2" face="Arial, Helvetica, sans-serif"><em>Anonymous CVS Access</em></font></p>

  <p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">This project's 

    SourceForge.net CVS repository can be checked out through anonymous (pserver) 

    CVS with the following instruction set. When prompted for a password for anonymous, 

    simply press the Enter key.</font></p>

  <pre>&gt; cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/taverna login 

&gt; cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/taverna co taverna1.0</pre>

  <div align="justify"><font size="2" face="Arial, Helvetica, sans-serif">Updates 

    from within the module's directory do not need the -d parameter.</font></div>

</blockquote>

<p align="justify"><font size="2" face="Arial, Helvetica, sans-serif">In order 

  to build Taverna, you may need to edit the build.xml. Specifically, if you don't 

  have the jikes compiler from IBM you'll need to change the 'build.compiler' 

  property from 'jikes' to 'modern'. Once that's done, you can build the enactor 

  plugin jar as described in the section previous to this one, or use the other 

  targets in the build file, see the readme.html inside your checked out project 

  directory for more build options.</font></p>

<hr>

<h2><font size="3" face="Arial, Helvetica, sans-serif">Web links</font></h2>

<ul>

  <li><font size="2" face="Arial, Helvetica, sans-serif"><a href="http://www.sourceforge.net/projects/taverna">Taverna 

    Sourceforge Project</a> </font> 

    <ul>

      <li><font size="2" face="Arial, Helvetica, sans-serif"><a href="http://sourceforge.net/docman/?group_id=74874">Documentation 

        store</a></font></li>

      <li><font size="2" face="Arial, Helvetica, sans-serif"><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/taverna/taverna1.0/">CVS 

        Browser</a></font></li>

    </ul>

  </li>

  <li><font size="2" face="Arial, Helvetica, sans-serif"><a href="http://www.ebi.ac.uk/collab/mygrid/service1/talisman">Talisman 

    instance at EBI</a> (if you're writing processors based on Talisman you'll 

    need to understand Talisman first)</font> </li>

</ul>

<hr>

</body>

</html>

