<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="styles.css" rel="stylesheet" type="text/css">
</head>

<body>
<h1>Taverna User Level Documentation</h1>
<p><em>Version 0.1.beta4, 12<sup>th</sup> June 2003, <a href="mailto:tmo@ebi.ac.uk">tmo@ebi.ac.uk</a></em></p>
  
<blockquote> <em>This document should provide enough information for other <sup>my</sup>Grid 
  developers to make use of the joint <a href="http://www.it-innovation.soton.ac.uk">IT 
  Innovation</a> / <a href="http://www.ebi.ac.uk">EBI</a> / <a href="http://www.hgmp.mrc.ac.uk">HGMP</a> 
  work on a new workflow language, its associated object model, parsers and views. 
  If there isn't sufficient information here, please email me (<a href="mailto:tmo@ebi.ac.uk">tmo@ebi.ac.uk</a>) 
  and pester me into providing it, there's not much point in us doing all this 
  work if you can't use it, right? </em>
  <p>The motivation for providing a new workflow language is not covered by this 
    document, but please refer to <a href="http://taverna.sourceforge.net">http://taverna.sourceforge.net</a> 
    for more information if you so desire.</p>
  <p>A note on stability - Taverna is an ongoing project, we reserve the right 
    to change things mentioned here if we feel justified in doing so. It would 
    be helpful to both us and yourself therefore if you were to let us know if 
    you're using any of this, just a quick mention on one of the <sup>my</sup>Grid 
    lists would be cool.</p>
  <p>Tom & Darren</p>
</blockquote>
<h2>Contents</h2>
<ul>
  <li><a href="#1">XScufl Workflow Language</a></li>
  <li><a href="#2">XScufl Anatomy </a>
<ul>
      <li><a href="#2a">Scufl</a></li>
      <li><a href="#2b">Processor</a></li>
      <li><a href="#2c">Link</a></li>
      <li><a href="#2d">Source + Sink</a></li>
      <li><a href="#2e">Coordination</a></li>
    </ul>
  </li>
  <li><a href="#3">XScufl Workflow Enactment using the IT Innovation Workflow 
    Enactor</a></li>
  <li><a href="#4">Configuring the <sup>my</sup>Grid Workflow Enactment Engine</a></li>
  <li><a href="#5">Obtaining and building a copy of the Taverna project code</a></li>
</ul>
<h2><a name="1"></a>XScufl Workflow Language</h2>
<blockquote>
  <p>XScufl is the XML dialect of the Simple Conceptual Unified Flow Language. 
    Operating at a higher level of abstraction than alternatives such as WSFL, 
    Scufl aims to provide the following features:</p>
  <ul>
    <li> Work with the same level of granularity that users will be thinking in.</li>
    <li> Invoke remote and local services and pass results between them, services 
      include at the present time.
      <ul>
        <li> Arbitrary WSDL-based single operation web services</li>
        <li> Soaplab bio-services</li>
        <li> Talisman tscript definitions</li>
        <li> Nested scufl workflows (to be implemented soon - tmo, 26th April 
          2003)</li>
      </ul>
    </li>
  </ul>
  <p>Ideally one conceptual operation in the design of a workflow translates to 
    one processor in a scufl definition. Although this may not always be possible, 
    in general you can be fairly close most of the time.</p>
  <p>In this document, the terms scufl and xscufl are used pretty much interchangably. 
    Although there is actually a textual version called scufl (to distinguish 
    it from the xml form) we haven't had time to bring that in synch with the 
    rest of the project, so for now I'm afraid you'll have to use the XML form.</p>
</blockquote>
<h2><a name="2"></a>XScufl Anatomy</h2>
<blockquote>
  <p>An XScufl file consists of the following tags, assuming that the namespace 
    's' has been defined as http://org.embl.ebi.escience/xscufl/0.1alpha</p>
	<p>
  <table width="610" border="1" cellpadding="4" cellspacing="0" bordercolor="#000000" background="menubarbacklight.png" bgcolor="#FFFFFF">
    <tr valign="top"> 
    <td width="25%"><pre>&lt;s:scufl&gt;</pre></td>
    <td width="75%"><p>This is the top level tag enclosing a single scufl workflow 
      definition.</p></td>
  </tr>
  <tr valign="top"> 
    <td><pre>&lt;s:processor&gt;</pre></td>
    <td> <p>Defines a single atomic processing step, for example the seqret tool 
        from Soaplab, or a single operation on an arbitrary web service.</p></td>
  </tr>
  <tr valign="top"> 
    <td><pre>&lt;s:link&gt;</pre></td>
    <td><p>Defines a data link between two processors.</p></td>
  </tr>
  <tr valign="top"> 
    <td><pre>&lt;s:source&gt;</pre></td>
    <td><p>Defines a workflow source, that is to say an externally visible input 
        into the workflow. Elements in the input.xml file map directly to these 
        source declarations.</p></td>
  </tr>
  <tr valign="top"> 
    <td><pre>&lt;s:sink&gt;</pre></td>
    <td><p>Defines a workflow sink, these map one to one to elements in the output 
        from the workflow enactor.</p></td>
  </tr>
  <tr valign="top"> 
    <td><pre>&lt;s:coordination&gt;</pre></td>
    <td><p>Defines a concurrency constraint.</p></td>
  </tr>
</table>
</p>
</blockquote>
<h2><a name="2a"></a>Top Level SCUFL Tag</h2>
<blockquote> 
  <pre>&lt;s:scufl version=&quot;0.1&quot;&gt;</pre>
  <p>This tag must have a version attribute, currently the version should be '0.1'. 
    There may also be an optional log attribute that indicates how much provenance 
    should be recorded. The log attribute can have values between 0 and 9, although 
    actual levels of support for provenance may differ between implementations 
    of the language.</p>
</blockquote>
<h2><a name="2b"></a>Processors</h2>
<blockquote> 
  <pre>&lt;s:processor name=&quot;the_processor_name&quot;&gt;</pre>
  <p>Processors have a name, this name may not include the ':' character and must 
    be unique within the workflow definition. A log attribute may also exist, 
    with possible values ranging from 0 and 9. It should be noted that the log 
    value for the scufl element takes precedence over any processor log levels. 
    The immediate single child element of the processor defines the type of operation. 
    Currently valid types are</p>
  <pre>&lt;s:soaplabwsdl&gt;http://url.to.your/soaplab/endpoint&lt;/s:soaplabwsdl&gt;</pre>
  <p>The soaplabwsdl processor type allows you to call a complete soaplab invocation 
    in one unit. The endpoint should be the full URL to the service endpoint, 
    so including, for example, edit::seqret at the end. Port names are extracted 
    from the keys of the Soaplab input and output Map objects.</p>
  <pre>&lt;s:arbitrarywsdl&gt;
  &lt;s:wsdl&gt;http://url.to.your/wsdl/definition/file.wsdl&lt;/s:wsdl&gt;
  &lt;s:porttype&gt;port_type_name&lt;/s:porttype&gt;
  &lt;s:operation&gt;operation_name&lt;/s:operation&gt;
&lt;/s:arbitrarywsdl&gt;</pre>
  <p>The arbitrarywsdl type allows a single call on a web service. Port names 
    are derived from the part names in the input and output messages for the specified 
    operation. </p>
  <pre>&lt;s:workflow&gt;
  &lt;s:xscufllocation&gt;http://url.to.your/xscufl/file&lt;/s:xscufllocation&gt;
&lt;/s:workflow&gt;</pre>
  <p>This allows you to define a processor based on another workflow, currently 
    only workflows in xscufl are supported. The processor thus created will have 
    inputs and outputs corresponding to the workflow source and sink definition 
    found in the specified URL</p>
  <pre>&lt;s:talisman&gt;
  &lt;s:tscript&gt;http://url.to.your/talisman/tscript/file.xml&lt;/s:tscript&gt;
&lt;/s:talisman&gt;
</pre>
  <p>The talisman type allows you to invoke a Talisman session as a service in 
    your workflow. Currently this doesn't use Talisman as a remote service, and 
    will run the application in the same address space as the enactor itself. 
    Although not ideal in the long run this should work fine for now. The tscript 
    tag contains the full URL to a tscript XML file; this in turn specifies the 
    Talisman application definition, a set of inputs and outputs and the operational 
    behavious of this service in terms of Talisman trigger invocations. The port 
    names are taken directly from the tscript file. The tscript definitions must 
    be accessible at processor creation time, but are not required after this 
    stage. The scripts look like this (in another file) :</p>
  <pre>    &lt;tscript url=&quot;http://localhost:8080/regex.xml&quot;
             trigger=&quot;Do Substitution&quot;&gt;
      &lt;input name=&quot;inputString&quot;&gt;field:SourceField&lt;/input&gt;
      &lt;output name=&quot;outputString&quot;&gt;field:SourceField&lt;/output&gt;
    &lt;/tscript&gt;</pre>
  The script above directs the creation of a Talisman application session from 
  the regex.xml file, then that first a string should be read from the port named 
  'inputString' and placed in the field with 'field:SourceField' as its locator 
  within the page (see Talisman documentation for exactly what this means), then 
  that a trigger called 'Do Substitution' should be run, then that the same Talisman 
  field should be copied to the output port 'outputString'. As it happens, this 
  script creates a processor that reads a string in and replaces all occurences 
  of a certain substring with 'foo' on its output port. There would normally be 
  multiple inputs and outputs, just that this application only has one of each. 
  <p>Processors communicate by named ports, these can be either input or output 
    ports, and are automatically built in the object model when one of the above 
    processor types is constructed. For this reason, there is no explicit port 
    declaration in the scufl language. In general, where a port reference is required, 
    it is of the form 'processor_name:port_name', hence the ban on ':' in processor 
    names (the parser code is simple and would be upset by it).</p>
</blockquote>
<h2><a name="2c"></a>Links or data constraints</h2>
<blockquote>
  <pre>&lt;s:link&gt;</pre>
  <p>Data links, or data constraints in the original language spec and the object 
    model, represent a flow of information from an output port to an input port. 
    The link syntax is very simple :</p>
  <pre>&lt;s:link&gt;
  &lt;s:input&gt;prophet:infile_direct_data&lt;/s:input&gt;
  &lt;s:output&gt;prophecy:outf&lt;/s:output&gt;
&lt;/s:link&gt;</pre>
  <p>The link syntax currently does not allow naming of links, if you particularly 
    need this then we could add it, at the moment a link is uniquely specified 
    by start and end ports, so a name is not really adding any information (duplicate 
    links are not permitted). As described above, the name for the port consists 
    of the processor name (within the scope of this workflow definition), followed 
    by a single colon ':' followed by the name of a port of the appropriate type 
    in that processor. Supplying an invalid name will result in an exception being 
    thrown on data model creation.</p>
  <p>If there is no colon in the name then the name is treated as an external 
    source or sink as appropriate.</p>
</blockquote>
<h2><a name="2d"></a>Workflow Sources and Sinks</h2>
<blockquote> 
  <pre>&lt;s:source&gt;</pre>
  <p>This defines a workflow source. You use these to get input data into the 
    workflow. The source is named, and this name can be used (without any processor 
    prefix and ':') in data links to connect a port in an internal processor to 
    a workflow source.</p>
  <pre>&lt;s:source&gt;input_sequence&lt;/s:source&gt;</pre>
  <p>The input document that the enactor reads contains named inputs; these names 
    should match with the names of your workflow sources. In addition, should 
    this workflow be used as a processor (nested workflow) in the future, the 
    source names will be mapped directly to input port names for the resultant 
    processor.</p>
  <pre>&lt;s:sink&gt;</pre>
  <p>This is similar to the source directive defined above, but defines an overall 
    workflow sink. As with the source, this may be used in a data link to send 
    a processor's output to the workflow sink, thus making it visible outside 
    the workflow.</p>
  <pre>&lt;s:sink&gt;some_output&lt;/s:sink&gt;</pre>
  <p>The output document produced by the workflow enactor contains named outputs 
    with a one to one mapping between these named outputs and workflow sinks.</p>
</blockquote>
<h2><a name="2e"></a>Coordination constraints</h2>
<blockquote> 
  <pre>&lt;s:coordination&gt;</pre>
  <p>The coordination constraints restrict the execution of processors contingent 
    on some gate condition being met. This is required when you have a process 
    where the stages must execute in a certain order and yet there is no direct 
    data dependency between them. An example of this is invocation of Soaplab 
    using the derived interfaces; we first create a job which returns a job ID 
    - no problem, we can block the next stage on that ID being returned, but then 
    we have to set inputs, run the job, get the results and clean up, none of 
    which have data links. So, we have a way to say 'only allow this processor 
    to go from scheduled to running if this other processor has status completed'. 
    In all probability you won't need to do this very often.</p>
  <pre>
&lt;s:coordination name=&quot;testcoordination&quot;&gt;
  &lt;s:condition&gt;
    &lt;s:target&gt;restrict_mutant&lt;/s:target&gt;
    &lt;s:state&gt;COMPLETED&lt;/s:state&gt;
  &lt;/s:condition&gt;
  &lt;s:action&gt;
    &lt;s:target&gt;compare&lt;/s:target&gt;
    &lt;s:statechange&gt;
      &lt;s:from&gt;SCHEDULED&lt;/s:from&gt;
      &lt;s:to&gt;RUNNING&lt;/s:to&gt;
    &lt;/s:statechange&gt;
  &lt;/s:action&gt;
&lt;/s:coordination&gt;</pre>
  <p>The above coordination block states that the processor 'compare' should only 
    be allowed to transition from 'scheduled' to 'running' if the processor 'restrict_mutant' 
    has achieved status 'completed'. Available states are scheduled, running, 
    completed and aborted.</p>
</blockquote>
<h2><a name="3"></a>XScufl Workflow Enactment using the IT Innovation Workflow 
  Enactor</h2>
<blockquote> 
  <p><strong>XScufl Language Support</strong></p>
  <p>The myGrid workflow enactment engine supports almost all the XScufl language 
    constructs. The most significant exception is that there is not full support 
    for the coodination constraints. In particular the enactment engine does not 
    support all possible state transitions that an XScufl coordination constraint 
    can define. This is essentially because the enactment engine has its own state 
    models that enforce correct behaviour for the activities it controls. At present 
    the enactment engine will only allow coordination constraints that conform 
    to the following state transition:</p>
  <p><img src="controlflow.png" width="358" height="60"></p>
  <p>At present the most common reason for using coordination constraints is to 
    represent a dependency between two processors that is not actually a data 
    dependency, this is essentially the case where you would like processor A 
    to execute and complete before processor B commences execution. In XScufl 
    this would be represented precisely as shown above for the coordination constraint 
    called 'testcoordination', given a suitable substitution of 'A' for 'restrict_mutant' 
    and 'B' for 'compare'. If the enactment engine receives a coordination constraint 
    that does not conform to this restriction then the workflow will be rejected 
    and no execution will take place.</p>
  <p>In addition the myGrid workflow enactment engine supports only 4 levels of 
    provenance logging not 10. The general meanings for different log levels are:</p>
  <ul>
    <li>0 (NONE) - No provenance logging takes place.</li>
    <li>1 (LOW) - Basic information including services invoked and start and end 
      times of processor executions.</li>
    <li>2 (NORMAL) - As with LOW but includes additional processor specific reporting.</li>
    <li>3-9 (HIGH) - As with NORMAL but includes additonal input and output data 
      values.</li>
  </ul>
  <p>Provenance information is generated as XML conforming to the included schema 
    'doc/enactor-provenance-report.xsd'. </p>
</blockquote>
<h2><a name="4"></a>Configuring the myGrid Workflow Enactment Engine</h2>
<blockquote> 
  <p>It is very easy to switch on myGrid Enactment Engine support for the XScufl 
    workflow language. The process only involves copying some libraries and making 
    some configuration changes. Note it is necessary to use Java 1.4.1 for the 
    Enactment Engine. The complete process is described here. 
  <ul>
    <li>
      <div align="left"> Install the myGrid Enactment Engine as directed by its 
        accompanying user manual. You should install version 0.1.4.4 or later.</div>
    </li>
    <li>
      <div align="left"> From within the Taverna source distribution directory 
        'taverna1.0' execute 'ant jar'. This builds the taverna library.</div>
    </li>
    <li>
      <div align="left"> Copy '<em>taverna1.0/build/</em>taverna-0.1beta4.jar' 
        to '<em>mygrid-wfenactor/lib</em>'.</div>
    </li>
    <li>
      <div align="left"> Copy '<em>taverna1.0/devlib/servlet.jar</em>' to '<em>mygrid-wfenactor/lib</em>'.</div>
    </li>
    <li>
      <div align="left"> Copy '<em>taverna1.0/lib/talisman1.4.5.11.jar</em>' to 
        '<em>mygrid-wfenactor/lib</em>'</div>
    </li>
  </ul>
  For Standalone Enactor continue by: 
  <ul>
    <li>
      <div align="left"> Edit the myGrid Enactment Engine configuration file 'mygrid-wfenactor/conf/standalone/mygrid.properties'. 
        In particular change the value for 'mygrid.workflow.enactor.api.class' 
        to 'uk.ac.soton.itinnovation.taverna.enactor.TavernaWorkflowEnactor' </div>
    </li>
    <li>
      <div align="left"> Edit the file 'mygrid-wfenactor/bin/runenactor.bat' by 
        adding '..\lib\taverna-0.1beta4.jar', '..\lib\servlet.jar' and '..\lib\talisman1.4.5.11.jar' 
        to the classpath argument. </div>
    </li>
  </ul>
  For Web Service Enactor continue by: 
  <ul>
    <li>
      <div align="left"> Edit the myGrid Enactment Engine configuration file 'mygrid-wfenactor/conf/webservice/mygrid.properties'. 
        In particular change the value for 'mygrid.workflow.enactor.api.class' 
        to 'uk.ac.soton.itinnovation.taverna.enactor.TavernaWorkflowEnactor' </div>
    </li>
    <li>
      <div align="left"> Edit the file 'mygrid-wfenactor/bin/runwsclient.bat' 
        by adding '..\lib\servlet.jar' to the classpath argument. </div>
    </li>
    <li>
      <div align="left"> Redeploy the myGrid Enactment Engine as directed by its 
        manual.</div>
    </li>
    <li>
      <div align="left">Copy 'taverna1.0/build/tavernaenactor.jar' to $TOMCAT_HOME/webapps/axis/WEB-INF/lib'</div>
    </li>
    <li>
      <div align="left">Restart Tomcat.</div>
    </li>
    <li>
      <div align="left">Off you go. </div>
    </li>
  </ul>
  <p>You can use the sample standalone and gui clients for the myGrid Enactment 
    Engine. There are sample emboss tutorial workflows, input and user files in 
    the directory 'taverna1.0/hybridworkflow'. </p>
  <p>The steps above assume that you have a copy of the Taverna project checked 
    out locally, and that you have also obtained the appropriate Talisman jar 
    file from somewhere (at the moment this is included in the Taverna lib directory, 
    obviously as the jar file name contains a version you should use the current 
    copy in your distribution).</p>
</blockquote>
<h2><a name="5"></a>Obtaining and building a copy of the Taverna project code</h2>
<blockquote> 
  <p>Copied from sourceforge's '<em>how to use anonymous cvs</em>' documentation 
    :</p>
  <p><em>Anonymous CVS Access</em></p>
  <p>This project's SourceForge.net CVS repository can be checked out through 
    anonymous (pserver) CVS with the following instruction set. When prompted 
    for a password for anonymous, simply press the Enter key.</p>
  <pre>&gt; cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/taverna login 
&gt; cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/taverna co taverna1.0</pre>
  <p>Updates from within the module's directory do not need the -d parameter.</p>
  <p>In order to build Taverna, you may need to edit the build.xml. Specifically, 
    if you don't have the jikes compiler from IBM you'll need to change the 'build.compiler' 
    property from 'jikes' to 'modern'. Once that's done, you can build the enactor 
    plugin jar as described in the section previous to this one, or use the other 
    targets in the build file, see the readme.html inside your checked out project 
    directory for more build options.</p>
</blockquote>
<p><a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=74874&type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a></p>
</body>



</html>




