<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Webservice Data Proxy</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1"></a>Webservice Data Proxy</h2></div></div><hr></div><div class="toc"><dl><dt><span class="section"><a href="#d0e4">1. Description</a></span></dt><dt><span class="section"><a href="#d0e12">2. Initial Configuration and Installation</a></span></dt><dt><span class="section"><a href="#d0e63">3. Adding Webservices</a></span></dt><dt><span class="section"><a href="#d0e72">4. Configuring Webservices</a></span></dt><dt><span class="section"><a href="#referencing">5. Referencing in action.</a></span></dt><dt><span class="section"><a href="#dereferencing">6. Data dereferencing</a></span></dt><dt><span class="section"><a href="#d0e112">7. Data housekeeping</a></span></dt><dt><span class="section"><a href="#d0e121">8. Current constraints and future work.</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4"></a>1.&nbsp;Description</h2></div></div></div><p>The main purpose of the Data Proxy is to overcome the problem of webservices that return large items of data causing <a href="http://taverna.sourceforge.net/index.php" target="_top">Taverna</a> to struggle or fail due to memory constraints. This is particularly the case when the service is invoked within an iteration. It solves this problem by allowing the user to select specific data elements for referencing, leading to the data to be stored on the proxy and the webserivce SOAP response is rewritten to replace the data itself with a URL to the actual data.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12"></a>2.&nbsp;Initial Configuration and Installation</h2></div></div></div><p>The Data Proxy source code can be downloaded from <a href="http://sourceforge.net/project/showfiles.php?group_id=74874" target="_top">http://sourceforge.net/project/showfiles.php?group_id=74874</a>, or can be downloaded as a war file from from the same location. It is a JSP based application designed to be deployed in a JSP container such as <a href="http://tomcat.apache.org/download-55.cgi" target="_top">Tomcat 5</a></p><p>Before deployment some minimal configuration is recommended. These are made by editing the web.xml which is found within the WEB-INF directory of the web-app (src/main/webapp if using the source bundle). The first change to make is to modify the location that the server configuration file is stored. This is configured by uncommented the block:</p><pre class="screen">&lt;!-- Uncomment and modify the value to define the location that the configuration file
is stored. Without this parameter it is stored in the root of the webapp context.  
&lt;context-param&gt;
   &lt;param-name&gt;ConfigFileLocation&lt;/param-name&gt;
   &lt;param-value&gt;/tmp/config.xml&lt;/param-value&gt;
&lt;/context-param&gt;
--&gt;</pre><p>and setting a suitable param-value for the ConfigFileLocation. If left commented out, the config.xml is stored in the root of web application context, but is not viewable.</p><p>If your proxy is to be shared with other users, either internally or via the internet, then its advisable to block access to the configuration pages. This is done by uncommenting the block:</p><pre class="screen">&lt;!-- Uncomment and modify if necessary to control access to the configuration pages
 You can define roles and users/passwords in the tomcat-users.xml of your tomcat installation. 
&lt;security-constraint&gt; 
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;Configuration&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/config/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;administrator&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;security-role&gt;
  &lt;role-name&gt;administrator&lt;/role-name&gt;
&lt;/security-role&gt;

&lt;login-config&gt;
   &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
   &lt;realm-name&gt;WebService data proxy administration&lt;/realm-name&gt;
&lt;/login-config&gt;
--&gt;</pre><p>You will also need to add a user, together with the role 'administrator' (or another if you changed both role-name elements) to your tomcat-users.xml file, stored within your Tomcat installation within the config directory. An example is:</p><pre class="screen">&lt;tomcat-users&gt;
  &lt;role rolename="administrator"/&gt;
  &lt;role rolename="manager"/&gt;
  &lt;user name="tomcat" password="tomcat" roles="tomcat,manager"/&gt;
  &lt;user name="elvis" password="12345" roles="administrator"/&gt;
&lt;/tomcat-users&gt;</pre><p>By default BASIC authentication is used using the MemoryRealm. This is adequate for most cases, but bear in mind that names and passwords are not stored or transported as encrypted. The paranoid might want to investigate configuring different <a href="http://tomcat.apache.org/tomcat-5.0-doc/realm-howto.html" target="_top">Realms</a>. The Realm is defined in META-INF/context.xml - note that with Tomcat 4 this needs to be configured in the Tomcat conf/server.xml.</p><p>The application is now ready to be deployed. If using the source code then it first needs to be build using <a href="http://maven.apache.org/" target="_top">Maven2</a>, and running 'mvn package' which creates a war file within the target directory. It is deployed by either dropping the war file into the Tomcat installation webapp/ directory, or via Tomcats <a href="http://tomcat.apache.org/tomcat-5.0-doc/manager-howto.html" target="_top">Manager</a> utility.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>By default the context name is the same as the war file. If built from source you will probably want to remove the version number from the generated war file.</p></div><p>Webservices are added and configured by visiting the address http://&lt;context&gt;/config, e.g http://localhost:8080/data-proxy/config. The first time this is visited some additional settings are requested:</p><div class="itemizedlist"><ul type="disc"><li><p>Server Context - this should be the fully qualified context of the server. This needs to be set rather than relying on using the request since it is the base of the URL used to define access to the stored data, and proxied endpoints, wsdl and schemas. It should be set to the full address that the server is visible by, rather than the local address.</p></li><li><p>Data Storage Location - this is the root location that the data will be stored. <span class="bold"><strong>Note that if running in Windows the path must be preceeded with a '/', e.g. /C:/tmp/data</strong></span></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e63"></a>3.&nbsp;Adding Webservices</h2></div></div></div><p>Once configured you should be presented with a page that gives a table of defined webservices, and a form to add a new webservice. Webservices are added by specifying the WSDL address together with a meaningful name. Once successfully added it will appear in the table, any errors are reported within the page footer.</p><p>The webservice appears in the table with its original WSDL address, and also a Proxy address. The Proxy address should be used when adding the service to Taverna, as this contains rewritten information to proxy any imported schemas and to point at the proxy endpoint. You can click on either link to view the WSDL.</p><p>You can configure or delete the webservice by selecting it (by clicking the left hand table column) and selecting the appropriate icon from the toolbar.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e72"></a>4.&nbsp;Configuring Webservices</h2></div></div></div><p>Once on the configuration screen you are presented with a list of available operations and their response elements in a tree structure. These can be expanded to explore the operation response elements, which if complex can be expanded further to explore each inner element. The format for the element is &lt;name&gt;:&lt;type&gt;.</p><p>Select an element and click the toggle button to turn referencing on or off. Once configuration is complete, click the save button to commit any changes.</p><div class="screenshot"><div class="mediaobject"><img src="resources/toggle.png"></div></div><p>The entire tree can be expanded or collapsed by clicking the '+' or '-' buttons respectively. Expanding the entire tree can be useful for finding elements previously selected to be referenced.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Bear in mind that selecting elements that are nested within another selected element will have no effect, since the data contained within the parent element is being redirected to a file so is never encountered for referencing.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="referencing"></a>5.&nbsp;Referencing in action.</h2></div></div></div><p>Once an operation response, or its nested element, has been selected for referencing the data contained within that element is no longer returned from the proxy, but instead is redirected to a file and replaced with a URL that provides access to the data stream. This means that a soap response that would normally return some data, would end up looking something like:</p><pre class="screen">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
   &lt;soapenv:Body&gt;
      &lt;getDataChunkResponse xmlns="http://testing.org"&gt;
         &lt;getDataChunkReturn&gt;http://localhost:8080/data-proxy/data?id=8fa33c3f-c06e5b3a-getDataChunkReturn1&lt;/getDataChunkReturn&gt;
      &lt;/getDataChunkResponse&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</pre><p>So, the data itself has been replaced with a URL http://localhost:8080/data-proxy/data?id=8fa33c3f-c06e5b3a-getDataChunkReturn1. Opening this URL in a browser will either display the data (if text), or allow it to be downloaded (if binary). The identifier to the data is composed of 3 parts - the WSDLID, the Invocation ID, and the elementName The elementname is appended with an iteration count, which is important if the element is an item in a list. On the server itself this data is stored in the location &lt;Data Storage Location&gt;/&lt;wsdlID&gt;/&lt;invocationID&gt;/elementName1.</p><p>This means that when adding the Proxy WSDL to Taverna as a WSDL Processor, the data produced as a processor output will contain the URL string rather than the data entity itself. This URL can be viewed in the results pane, or passed onto another processor. If passed on to another service being filtered by the proxy, then the data is <a href="#dereferencing" title="6.&nbsp;Data dereferencing">de-referenced</a> back to the original data before reaching the 'real' service endpoint.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If the data selected for referencing is part of a complex type where there are further child elements, the XML structure gets written to the file unwrapped, and is presented through the URL, just as it occurs within the SOAP message.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dereferencing"></a>6.&nbsp;Data dereferencing</h2></div></div></div><p>If in the outgoing soap request a URL matching the data streaming servlet (&lt;Server Context&gt;/data?id=) is encountered within the content of a data element it is dereferenced back to the original data. This is useful so that a Taverna workflow can orchestrate a large data entity being passed between 2 (or more) service operations without ever actually passing through Taverna itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e112"></a>7.&nbsp;Data housekeeping</h2></div></div></div><p>No code in any of the Data Proxy will EVER delete any data. To remove old unwanted data you need to physically delete the files within the Data Storage Location specified during configuration.</p><p>Data can be moved to a new location, and the Data Storage Location modified, as long as it keeps the original directory structure. The data streaming servlet, and the de-referencing of the data, relies on the components of the identifier in the URL being translated to and from this directory structure. This structure is described in the section on <a href="#referencing" title="5.&nbsp;Referencing in action.">referencing.</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e121"></a>8.&nbsp;Current constraints and future work.</h2></div></div></div><p>Being an early release there are currently a few contraints: </p><div class="itemizedlist"><ul type="disc"><li><p>The schema is not rewritten to reflect changes in the data structure. If a complex type is set to be referenced then the schema will not reflect that this has changed to a anyURI or xsd:string element. A current workaround for this is to make a copy of the original WSDL to a file, hand craft the schema by hand but leaving the rest of the WSDL intact, and point the Data Proxy at this copy of the WSDL.</p></li><li><p>If a service defined as RPC/encoded and the response consists of a complex type, then the response may use <a href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383512" target="_top">SOAP Encoding</a> leading to the XML structure being multi-referenced. The data proxy does handle this. This problem does not affect document/literal style services or rpc/encoded services that return a primitive type.</p></li></ul></div><p> These will be addressed depending upon the uptake of this utility and the impact of these constaints.</p></div></div></body></html>