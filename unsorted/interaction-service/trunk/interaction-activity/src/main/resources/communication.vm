<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
      <title></title>
  </head>
  <body>
       <script type="text/javascript" src="$pmrpcUrl"></script>
       
       <script type="text/javascript">

         function createReplyContent(status, results) {
           date = new Date();
           msg = "";
           msg += "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n";
           msg += "<entry xmlns=\"http://www.w3.org/2005/Atom\" xmlns:thr=\"http://purl.org/syndication/thread/1.0\">\n";
           msg += "<title>\"A reply\"</title>\n";
           msg += "<id>" + "$entryId" + "-reply" + "</id>\n";
           msg += "<thr:in-reply-to ref=\"" + "$entryId" + "\"/>\n";
           msg += "<content/>\n";
           msg += "<interaction:resultStatus xmlns:interaction=\"http://ns.taverna.org.uk/2012/interaction\">"
           msg += status;
           msg += "</interaction:resultStatus>";
           msg += "<interaction:resultData xmlns:interaction=\"http://ns.taverna.org.uk/2012/interaction\">\n";
		   msg += results;
           msg += "</interaction:resultData>\n";
           msg += "</entry>\n";
           return msg;
         }

         function reply(status, results) {
           msg = createReplyContent(status, JSON.stringify(results));
           xmlhttp = new XMLHttpRequest();
           xmlhttp.open("POST", "$feed", true);
           xmlhttp.onreadystatechange=function() {
//               alert(xmlhttp.responseText);
           }
           xmlhttp.setRequestHeader("Content-Type", "application/atom+xml;type=entry");
           xmlhttp.setRequestHeader("Content-Length", msg.length);
           xmlhttp.setRequestHeader("Slug", "$entryId" + "-reply");
           xmlhttp.send(msg);
           return false;
         }
         
         pmrpc.register( {
         	publicProcedureName : "reply",
         	procedure : function(status, results) {
         	   reply(status, results);
         	   return "OK";
         	}
         });
         
         pmrpc.register( {
           publicProcedureName : "getInputData",
           procedure : function() {
             return JSON.parse('$inputData');
           }
         });
     </script>
  </body>
</html>

     