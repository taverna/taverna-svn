<?xml version="1.0" encoding="UTF-8"?>
<s:scufl xmlns:s="http://org.embl.ebi.escience/xscufl/0.1alpha" version="0.2" log="0">
  <s:workflowdescription lsid="urn:lsid:www.mygrid.org.uk:operation:K46HHHQ37C5" author="" title="" />
  <s:processor name="String_Constant" boring="true">
    <s:stringconstant>NCBI_gi</s:stringconstant>
  </s:processor>
  <s:processor name="Create_moby_data">
    <s:local>org.embl.ebi.escience.scuflworkers.biomoby.CreateMobyData</s:local>
  </s:processor>
  <s:processor name="Extract_accession">
    <s:beanshell>
      <s:scriptvalue>java.util.regex.Pattern p = java.util.regex.Pattern.compile("namespace=\'NCBI_Acc\' +id=\'([A-z[0-9]]+)\'");

java.util.regex.Matcher m = p.matcher(in);

java.util.List accs = new ArrayList();

while(m.find()){
	accs.add(m.group(1));
}</s:scriptvalue>
      <s:beanshellinputlist>
        <s:beanshellinput s:syntactictype="'text/plain'">in</s:beanshellinput>
      </s:beanshellinputlist>
      <s:beanshelloutputlist>
        <s:beanshelloutput s:syntactictype="'text/plain'">accs</s:beanshelloutput>
      </s:beanshelloutputlist>
    </s:beanshell>
  </s:processor>
  <s:processor name="Extract_best_hit">
    <s:beanshell>
      <s:scriptvalue>java.util.regex.Pattern p = java.util.regex.Pattern.compile("&gt;(At[1-5]g\\d{5,5})");

java.util.regex.Matcher m = p.matcher(in);

String agi = "notfound";

while(m.find()){
	agi = m.group(1);
	break;
}
java.util.regex.Pattern p1 = java.util.regex.Pattern.compile("Identities = [0-9]+/[0-9]+ [(]([0-9]+)%[)]");

java.util.regex.Matcher m1 = p1.matcher(in);

String id = "0";

while(m1.find()){
	id = m1.group(1);
	break;
}</s:scriptvalue>
      <s:beanshellinputlist>
        <s:beanshellinput s:syntactictype="'text/plain'">in</s:beanshellinput>
      </s:beanshellinputlist>
      <s:beanshelloutputlist>
        <s:beanshelloutput s:syntactictype="'text/plain'">agi</s:beanshelloutput>
        <s:beanshelloutput s:syntactictype="'text/plain'">id</s:beanshelloutput>
      </s:beanshelloutputlist>
    </s:beanshell>
  </s:processor>
  <s:processor name="MIPSBlastBetterE13">
    <s:description>executes blast against MAtDB Arabidopsis protein coding genes with a cutoff E-value of E=1e-13</s:description>
    <s:biomobywsdl>
      <s:mobyEndpoint>http://mobycentral.icapture.ubc.ca/cgi-bin/MOBY05/mobycentral.pl</s:mobyEndpoint>
      <s:serviceName>MIPSBlastBetterE13</s:serviceName>
      <s:authorityName>mips.gsf.de</s:authorityName>
    </s:biomobywsdl>
  </s:processor>
  <s:processor name="MOBYSHoundGetGenBankWhateverSequence">
    <s:description>consumes a NCBI_Acc, NCBI_gi, PIR, SwissProt, Embl, 
or PDB identifier and returns the equivalent genbank record as a 
DNA, RNA, AminoAcid sequence object as appropriate</s:description>
    <s:biomobywsdl>
      <s:mobyEndpoint>http://mobycentral.icapture.ubc.ca/cgi-bin/MOBY05/mobycentral.pl</s:mobyEndpoint>
      <s:serviceName>MOBYSHoundGetGenBankWhateverSequence</s:serviceName>
      <s:authorityName>bioinfo.icapture.ubc.ca</s:authorityName>
    </s:biomobywsdl>
  </s:processor>
  <s:link source="gi" sink="Create_moby_data:id" />
  <s:link source="Extract_accession:accs" sink="acc" />
  <s:link source="Extract_best_hit:agi" sink="AGI" />
  <s:link source="Extract_best_hit:id" sink="identity" />
  <s:link source="String_Constant:value" sink="Create_moby_data:namespace" />
  <s:link source="gi" sink="gi" />
  <s:link source="Create_moby_data:mobydata" sink="MOBYSHoundGetGenBankWhateverSequence:input" />
  <s:link source="MIPSBlastBetterE13:output" sink="Extract_best_hit:in" />
  <s:link source="MOBYSHoundGetGenBankWhateverSequence:output" sink="Extract_accession:in" />
  <s:link source="MOBYSHoundGetGenBankWhateverSequence:output" sink="MIPSBlastBetterE13:input" />
  <s:source name="gi" />
  <s:sink name="acc">
    <s:metadata>
      <s:mimeTypes>
        <s:mimeType>text/xml</s:mimeType>
      </s:mimeTypes>
    </s:metadata>
  </s:sink>
  <s:sink name="AGI" />
  <s:sink name="identity">
    <s:metadata>
      <s:description>%identity of the BLAST match</s:description>
    </s:metadata>
  </s:sink>
  <s:sink name="gi" />
</s:scufl>


