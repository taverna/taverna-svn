<!-- This is the top level build file for the Taverna project -->
<!-- Tom Oinn (tmo@ebi.ac.uk) 25th Feb 2003                   -->
<project name="taverna" default="all" basedir=".">

	<!-- General property setup -->
	<target name="init">
		<property name="src.dir" value="./src"/>
		<property name="build.dir" value="./build"/>
		<property name="build.src" value="${build.dir}/src"/>
		<property name="build.classes" value="${build.dir}/classes"/>
		<property name="build.javadocs" value="${build.dir}/api"/>
		<property name="build.compiler" value="jikes"/>
	</target>
	
	<!-- Path used during compilation -->
	<path id="compile-classpath">
		<fileset dir="./lib">
			<include name="*.jar"/>
		</fileset>
		<pathelement path="${build.classes}"/>
		<pathelement path="${build.src}"/>
	</path>

	<!-- AspectJ task -->
	<taskdef name="ajc" classname="org.aspectj.tools.ant.taskdefs.Ajc" >
    	<!-- declare classes needed to run the tasks and tools -->
    	<classpath refid="compile-classpath"/>
	</taskdef>

	<!-- Path used after compilation to run things -->
	<path id="run-classpath">
		<fileset dir="./lib">
			<include name="*.jar"/>
		</fileset>
		<fileset dir="./build">
			<include name="*.jar"/>
		</fileset>
	</path>

	<!-- Clean the build -->
	<target name="clean" depends="init">
		<delete dir="${build.dir}"/>
	</target>

	<!-- Trivial setup -->
	<target name="prepare" depends="init">
		<mkdir dir="${build.dir}"/>
	</target>

	<!-- Build jar file and javadocs -->
	<target name="all" depends="jar,javadoc"/>

	<!-- Prepare the source tree for compilation -->
	<target name="prepare-src" depends="prepare">
		<mkdir dir="${build.src}"/>
		<mkdir dir="${build.classes}"/>
		<copy todir="${build.src}" filtering="on">
			<fileset dir="${src.dir}">
				<include name="**/*.properties"/>
				<include name="**/*.html"/>
				<include name="**/*.xml"/>
			</fileset>
		</copy>
		<!-- Use aspectj to prepare the source files -->
		<ajc srcdir="${src.dir}"
			 preprocess="true"
			 workingdir="${build.src}">
			<classpath refid="compile-classpath"/>
		</ajc>
	</target>

	<!-- Compile the source files -->
	<target name="java" depends="prepare-src">
		<javac srcdir="${build.src}" destdir="${build.classes}">
			<classpath refid="compile-classpath"/>
		</javac>
		<copy todir="${build.classes}" filtering="on">
			<fileset dir="${src.dir}">
				<include name="**/*.properties"/>
				<include name="**/*.xml"/>
			</fileset>
		</copy>
	</target>

	<!-- Create a jar of the talisman classes and configuration files -->
	<target name="jar" depends="java">
		<jar destfile="${build.dir}/taverna.jar" basedir="${build.classes}" update="no"/>
	</target>

	<!-- Build javadocs -->
	<target name="javadoc" depends="prepare-src">
		<mkdir dir="${build.javadocs}"/>
		<javadoc windowtitle="Taverna Java Classes" destdir="${build.javadocs}" sourcepath="${build.src}" doctitle="&lt;h1>Taverna Java API Documentation&lt;/h1>" author="true" bottom="" packagenames="*" version="true">
			<classpath refid="compile-classpath"/>
		</javadoc>
	</target>
		
</project>
